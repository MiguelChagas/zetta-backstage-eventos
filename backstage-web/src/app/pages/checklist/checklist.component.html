<nav class="navbar navbar-dark bg-dark mb-4 px-4">
  <div class="container-fluid">
    <a class="btn btn-outline-light btn-sm" routerLink="/dashboard">
      â¬… Voltar
    </a>
    <span class="navbar-brand mb-0 h1 mx-auto">{{ evento?.nome }}</span>
    <span class="badge bg-secondary">{{ tarefas.length }} Tarefas</span>
  </div>
</nav>

<div class="container">
  <div class="card shadow-sm border-0 mb-4 bg-light">
    <div class="card-body">
      <h5 class="card-title mb-3 text-primary">ğŸ“ Adicionar Tarefa</h5>

      <div class="row g-2 mb-2">
        <div class="col-md-5">
          <input
            type="text"
            class="form-control"
            placeholder="TÃ­tulo da tarefa"
            [(ngModel)]="novaTarefa.nome"
          />
        </div>

        <div class="col-md-3">
          <select class="form-select" [(ngModel)]="novaTarefa.categoria">
            <option value="GERAL">ğŸ“‚ Geral</option>
            <option value="SOM">ğŸ”Š Som</option>
            <option value="LUZ">ğŸ’¡ IluminaÃ§Ã£o</option>
            <option value="PALCO">ğŸ—ï¸ Palco</option>
            <option value="LOGISTICA">ğŸšš LogÃ­stica</option>
          </select>
        </div>

        <div class="col-md-4">
          <select class="form-select" [(ngModel)]="novaTarefa.prioridade">
            <option value="ALTA">ğŸ”¥ Alta Prioridade</option>
            <option value="MEDIA">âš ï¸ MÃ©dia Prioridade</option>
            <option value="BAIXA">â˜• Baixa Prioridade</option>
          </select>
        </div>
      </div>

      <div class="row g-2">
        <div class="col-md-8">
          <input
            type="text"
            class="form-control"
            placeholder="DescriÃ§Ã£o detalhada"
            [(ngModel)]="novaTarefa.descricao"
          />
        </div>

        <div class="col-md-2">
          <input
            type="datetime-local"
            class="form-control"
            [(ngModel)]="novaTarefa.dataLimite"
          />
        </div>

        <div class="col-md-2">
          <button
            class="btn btn-primary w-100 fw-bold"
            (click)="adicionarTarefa()"
            [disabled]="!novaTarefa.nome"
          >
            Adicionar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- SeÃ§Ã£o de Filtros -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3 text-info">ğŸ” Filtrar Tarefas</h5>

      <div class="row g-2">
        <div class="col-md-4">
          <label class="form-label small fw-bold">Status:</label>
          <select
            class="form-select"
            [(ngModel)]="filtroStatus"
            (change)="aplicarFiltro()"
          >
            <option value="TODOS">ğŸ“‹ Todos</option>
            <option value="PENDENTE">â¬œ Pendentes</option>
            <option value="CONCLUIDO">âœ… ConcluÃ­das</option>
          </select>
        </div>

        <div class="col-md-5">
          <label class="form-label small fw-bold">Categoria:</label>
          <select
            class="form-select"
            [(ngModel)]="filtroCategoria"
            (change)="aplicarFiltro()"
          >
            <option value="TODOS">ğŸ“‚ Todas</option>
            <option value="GERAL">ğŸ“‚ Geral</option>
            <option value="SOM">ğŸ”Š Som</option>
            <option value="LUZ">ğŸ’¡ IluminaÃ§Ã£o</option>
            <option value="PALCO">ğŸ—ï¸ Palco</option>
            <option value="LOGISTICA">ğŸšš LogÃ­stica</option>
          </select>
        </div>

        <div class="col-md-3 d-flex align-items-end">
          <button
            class="btn btn-outline-secondary w-100"
            (click)="limparFiltros()"
            [disabled]="filtroStatus === 'TODOS' && filtroCategoria === 'TODOS'"
          >
            ğŸ”„ Limpar Filtros
          </button>
        </div>
      </div>

      <div
        class="mt-2 text-muted small"
        *ngIf="filtroStatus !== 'TODOS' || filtroCategoria !== 'TODOS'"
      >
        <strong>Filtros ativos:</strong>
        <span *ngIf="filtroStatus !== 'TODOS'" class="badge bg-primary ms-1">{{
          filtroStatus
        }}</span>
        <span *ngIf="filtroCategoria !== 'TODOS'" class="badge bg-info ms-1">{{
          filtroCategoria
        }}</span>
      </div>
    </div>
  </div>

  <div class="list-group shadow-sm">
    <div
      *ngFor="let item of tarefas"
      class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3"
      [class.bg-light]="item.status === 'CONCLUIDO'"
      style="transition: all 0.2s"
    >
      <div class="w-100 me-3">
        <div class="d-flex flex-wrap align-items-center gap-2 mb-1">
          <span *ngIf="item.status === 'CONCLUIDO'" class="text-success fs-5"
            >âœ…</span
          >
          <span *ngIf="item.status === 'PENDENTE'" class="text-secondary fs-5"
            >â¬œ</span
          >

          <h5
            class="mb-0 fw-bold"
            [class.text-decoration-line-through]="item.status === 'CONCLUIDO'"
            [class.text-muted]="item.status === 'CONCLUIDO'"
          >
            {{ item.nome }}
          </h5>

          <span
            class="badge rounded-pill"
            [ngClass]="{
              'bg-danger': item.prioridade === 'ALTA',
              'bg-warning text-dark': item.prioridade === 'MEDIA',
              'bg-info text-dark': item.prioridade === 'BAIXA',
            }"
          >
            {{ item.prioridade }}
          </span>

          <span
            class="badge bg-secondary border border-light"
            *ngIf="item.categoria"
          >
            {{ item.categoria }}
          </span>
        </div>

        <p
          class="mb-1 text-secondary"
          *ngIf="item.descricao"
          style="font-size: 0.95rem"
        >
          {{ item.descricao }}
        </p>

        <small class="text-muted d-block mt-1">
          ğŸ“… Prazo:
          <span *ngIf="item.dataLimite">{{
            item.dataLimite | date: "dd/MM/yyyy HH:mm"
          }}</span>
          <span *ngIf="!item.dataLimite">Sem prazo</span>
        </small>
      </div>

      <div class="d-flex flex-column gap-2">
        <button
          class="btn btn-sm px-3 rounded-pill text-nowrap"
          [ngClass]="
            item.status === 'CONCLUIDO'
              ? 'btn-outline-secondary'
              : 'btn-success'
          "
          (click)="alternarStatus(item)"
        >
          {{ item.status === "CONCLUIDO" ? "Reabrir" : "Concluir" }}
        </button>
        <button
          class="btn btn-sm btn-outline-danger px-3 rounded-pill text-nowrap"
          (click)="deletarItem(item)"
        >
          ğŸ—‘ï¸ Deletar
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="tarefas.length === 0" class="text-center mt-5 text-muted">
    <h3 class="display-6">Nada por aqui... ğŸƒ</h3>
    <p>Adicione a primeira tarefa acima para comeÃ§ar o trabalho!</p>
  </div>
</div>
